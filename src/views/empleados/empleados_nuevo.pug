extends ../layout

block content
  .container.mt-4
    h2 Nuevo Empleado

    if error
      .alert.alert-danger= error

    form(method="POST" action="/empleados/nuevo")

      .row
        .col-md-6
          .mb-3
            label.form-label Nombre
            input.form-control(
              type="text"
              name="nombre"
              autocomplete="off"
              required
              value=formData && formData.nombre ? formData.nombre : ""
            )

        .col-md-6
          .mb-3
            label.form-label Apellido
            input.form-control(
              type="text"
              name="apellido"
              autocomplete="off"
              required
              value=formData && formData.apellido ? formData.apellido : ""
            )

      .row
        .col-md-6
          .mb-3
            label.form-label DNI
            input.form-control(
              type="text"
              name="dni"
              autocomplete="off"
              required
              value=formData && formData.dni ? formData.dni : ""
            )

        .col-md-6
          .mb-3
            label.form-label Tel√©fono
            input.form-control(
              type="text"
              name="telefono"
              autocomplete="off"
              value=formData && formData.telefono ? formData.telefono : ""
            )

      .mb-3
        label.form-label Email
        input.form-control(
          type="email"
          name="email"
          autocomplete="off"
          required
          value=formData && formData.email ? formData.email : ""
        )

      // 
      // SELECT √ÅREA
      // 
      .mb-3
        label.form-label √Årea
        select.form-select(name="area" id="areaSelect" required)
          option(value="" disabled selected=!(formData && formData.area)) Seleccionar √°rea
          each a in areas
            option(
              value=a
              selected=(formData && formData.area === a)
            )= a

      // 
      // SELECT ROL (DIN√ÅMICO)
      // 
      .mb-3
        label.form-label Rol
        select.form-select(name="rol" id="rolSelect" required)
          option(value="" disabled selected=!(formData && formData.rol)) Seleccionar rol
          // opciones din√°micas generadas por JS

      .mb-3
        label.form-label Contrase√±a
        .input-group
          input.form-control(
            type="password"
            name="password"
            id="pw"
            autocomplete="new-password"
            required
          )
          button.btn.btn-outline-secondary(type="button" id="togglePw") üëÅ

      .d-flex.gap-2
        a.btn.btn-secondary(href="/empleados") Volver
        button.btn.btn-primary(type="submit") Guardar

  // 
  // SCRIPT PARA ROLES DIN√ÅMICOS
  //
  script.
    const rolesDisponibles = {
      "Administraci√≥n de Turnos": ["administrador", "recepcionista"],
      "Atenci√≥n M√©dica": ["m√©dico"],
      "Stock de Insumos": ["encargado de stock"],
      "Facturaci√≥n": ["administrador", "recepcionista"]
    };

    const areaSelect = document.getElementById("areaSelect");
    const rolSelect = document.getElementById("rolSelect");

    function cargarRoles() {
      const area = areaSelect.value;
      const roles = rolesDisponibles[area] || [];

      rolSelect.innerHTML = '<option value="" disabled selected>Seleccionar rol</option>';

      roles.forEach(r => {
        const opt = document.createElement("option");
        opt.value = r;
        opt.textContent = r;
        if ("#{formData && formData.rol}" === r) opt.selected = true;
        rolSelect.appendChild(opt);
      });
    }

    areaSelect.addEventListener("change", cargarRoles);

    // Inicializa si venimos de un error
    if ("#{formData && formData.area}") {
      cargarRoles();
    }

    // Mostrar/ocultar contrase√±a
    document.getElementById("togglePw").onclick = () => {
      const pw = document.getElementById("pw");
      pw.type = pw.type === "password" ? "text" : "password";
    };










