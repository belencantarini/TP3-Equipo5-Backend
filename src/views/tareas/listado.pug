extends ../layout

block content
  .container.mt-4

  h2 Lista de Tareas


  .text-end.mb-3
    a.btn.btn-primary(href="/tareas/nuevo") Nueva Tarea
  
  if error
    .alert.alert-danger(role="alert")
    #{error}
  
          
        // -----------------------
        // 2. FORMULARIO DE FILTROS
        // -----------------------
  h4.mb-3 Filtros
        .card.p-3.mb-5
          
          form.row.g-3(action="/tareas", method="get")
            
            // FILTRO 츼REA
            .col-md-3
              label.form-label(for="area") 츼rea:
              select.form-select(name="area")
                option(value="") Todas
                each a in areas
                  option(value=a selected=(filtros.area == a))= a

            // FILTRO EMPLEADO
            .col-md-3
              label.form-label(for="empleadoId") Empleado:
              select.form-select(name="empleadoId")
                option(value="") Todos
                each e in empleados
                  option(value=e._id selected=(filtros.empleadoId == e._id))
                    | Id: #{e._id} - #{e.nombre} #{e.apellido}

            // FILTRO PACIENTE
            .col-md-3
              label.form-label(for="pacienteId") Paciente:
              select.form-select(name="pacienteId")
                option(value="") Todos
                each p in pacientes
                  option(value=p._id selected=(filtros.pacienteId == p._id))
                    | Id: #{p._id} - #{p.nombre} #{p.apellido}
            
            // FILTRO ESTADO
            .col-md-3
              label.form-label(for="estado") Estado:
              select.form-select(name="estado")
                option(value="") Todos
                each est in estados
                  option(value=est selected=(filtros.estado == est))= est

            // FILTRO PRIORIDAD
            .col-md-3
              label.form-label(for="prioridad") Prioridad:
              select.form-select(name="prioridad")
                option(value="") Todas
                each pri in prioridades
                  option(value=pri selected=(filtros.prioridad == pri))= pri

            // FILTRO FECHA
            .col-md-3
              label.form-label(for="fecha") Fecha (Inicio):
              input.form-control(type="date" name="fecha" value=(filtros.fecha || ''))

            // BOTONES DE FILTRO
            .col-12.d-flex.gap-2.mt-3
              button.btn.btn-primary(type="submit") 游댍 Filtrar
              // 4. Quitar 'tareasmongo' del bot칩n de limpiar
              button.btn.btn-outline-secondary(type="button", onclick="location.href='/tareas'") Limpiar filtros
        
        // -----------------------
        // 5. LISTADO (Tabla)
        // -----------------------
        
        h3.mb-3 Tareas Encontradas

        if tareas && tareas.length
          .table-responsive.d-none.d-md-block
            table.table.table-striped.table-hover.table-sm
              thead
                tr
                  th #ID
                  th 츼rea
                  th Tipo
                  th Estado
                  th Prioridad
                  th Empleado
                  th Paciente
                  th.text-nowrap Acciones
              tbody
                each t in tareas
                  tr
                    td= t._id
                    td= t.area
                    td= t.tipo
                    td= t.estado
                    td= t.prioridad
                    // Nota: Aqu칤 solo muestra el ID, deber칤as buscar el nombre en el backend para mejor UX
                    td= t.empleadoId || 'N/A'
                    td= t.pacienteId || 'N/A'
                    td
                      a.btn.btn-sm.btn-warning(href=`/tareas/editar/${t._id}`) Editar
                      form(action=`/tareas/eliminar/${t._id}?_method=DELETE`, method="post", style="display:inline")
                        button.btn.btn-sm.btn-danger(type="submit", onclick="return confirm('쮼st치 seguro de que desea eliminar esta tarea?')") Eliminar


          .d-md-none
            each t in tareas
              .card.mb-3
                .card-header 
                  // Muestra el ID como t칤tulo de la tarjeta
                  strong Tarea ID: 
                  | #{t._id}
                .card-body
                  // Lista de Definici칩n (dt/dd) para mostrar los datos de forma vertical
                  dl.row
                    dt.col-5 츼rea:
                    dd.col-7= t.area

                    dt.col-5 Tipo:
                    dd.col-7= t.tipo

                    dt.col-5 Estado:
                    // Usamos una badge (etiqueta) para que el estado destaque
                    dd.col-7 
                      span.badge.bg-primary= t.estado 

                    dt.col-5 Prioridad:
                    dd.col-7 
                      span.badge(class=`${t.prioridad === 'Urgente' ? 'bg-danger' : 'bg-secondary'}`)= t.prioridad 

                    dt.col-5 Empleado:
                    dd.col-7= t.empleadoId || 'N/A'

                    dt.col-5 Paciente:
                    dd.col-7= t.pacienteId || 'N/A'

                .card-footer.d-flex.gap-2.justify-content-end 
                  a.btn.btn-sm.btn-warning(href=`/tareas/editar/${t._id}`) Editar
                  form(action=`/tareas/eliminar/${t._id}?_method=DELETE`, method="post", style="display:inline")
                    button.btn.btn-sm.btn-danger(type="submit", onclick="return confirm('쮼st치 seguro de que desea eliminar esta tarea?')") Eliminar
        else
          .alert.alert-info No hay tareas que coincidan con los filtros aplicados.