require('dotenv').config();
const mongoose = require('mongoose');
const bcrypt = require('bcrypt');
const Empleado = require('../models/empleadoMongoModel');

(async () => {
    try {
        await mongoose.connect(process.env.MONGO_URI);

        const existe = await Empleado.findOne({ email: 'admin@clinica.com' });
        if (existe) {
            console.log("⚠ Ya existe un admin, no se crea otro.");
            process.exit();
        }

        const hashed = await bcrypt.hash("admin123", 10);

        const nuevo = new Empleado({
            nombre: "Super",
            apellido: "Admin",
            dni: "11111111",
            telefono: "123456789",
            area: "Administración General",
            email: "admin@clinica.com",
            password: hashed,
            rol: "administrador"
        });

        await nuevo.save();
        console.log("✅ Admin creado con éxito:");
        console.log("   Email: admin@clinica.com");
        console.log("   Password: admin123");

        process.exit();

    } catch (err) {
        console.error("❌ Error creando admin:", err.message);
        process.exit();
    }
})();
